<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>University Event Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <base href="/iteam-university-website/admin/">
    <!-- Include font CSS files -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Include remixicon CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet" />
    
    <!-- Include Tailwind CSS only once -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Include your custom CSS -->
    <link href="style.css" rel="stylesheet" />
    
    <!-- Include ECharts for charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    
    <!-- Tailwind configuration -->
    <script>
      tailwind.config = {
        darkMode: "class", // or 'media'
        theme: {
          extend: {
            colors: {
              primary: 'var(--theme-primary)', // Use CSS variable
              secondary: 'var(--theme-secondary)', // Use CSS variable
            },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
  </head>
  <body class="min-h-screen flex">
    <!-- Sidebar -->
    <aside
      class="sidebar fixed h-full w-64 hidden md:block overflow-y-auto z-10"
    >
      <div class="p-4 flex items-center">
        <a
          href="dashboard"
          class="flex items-center text-gray-800 dark:text-gray-200"
        >
          <!-- <img
            src="assets/images/logo.svg"
            alt="Logo"
            class="w-10 h-10 mr-2"
          /> -->
        <span class="text-2xl font-['Pacifico'] text-primary">iTeam University</span>
        </a>
      </div>
      <nav class="mt-6">
        <div
          class="px-4 mb-2 text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400"
        >
          Main
        </div>
        <a
          href="dashboard.html"
          class="nav-link flex items-center px-4 py-3 active"
        >
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-dashboard-line"></i>
          </div>
          <span>Dashboard</span>
        </a>
        <a href="events.html" class="nav-link flex items-center px-4 py-3">
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-calendar-event-line"></i>
          </div>
          <span>Events</span>
        </a>
        <a href="calendar.html" class="nav-link flex items-center px-4 py-3" data-view="calendar.html">
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-calendar-line"></i>
          </div>
          <span>Calendar</span>
        </a>
        <a
          href="organizations.html"
          class="nav-link flex items-center px-4 py-3"
        >
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-building-line"></i>
          </div>
          <span>Organizations</span>
        </a>
        <a href="students.html" class="nav-link flex items-center px-4 py-3">
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-user-line"></i>
          </div>
          <span>Students</span>
        </a>
        <a href="gallery.html" class="nav-link flex items-center px-4 py-3">
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-gallery-line"></i>
          </div>
          <span>Gallery</span>
        </a>
        <a href="manage-images.html" class="nav-link flex items-center px-4 py-3">
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-image-line"></i>
          </div>
          <span>Manage Images</span>
        </a>
        <div
          class="px-4 mt-6 mb-2 text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400"
        >
          Account
        </div>
        <a href="profile.html" class="nav-link flex items-center px-4 py-3">
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-user-settings-line"></i>
          </div>
          <span>Profile</span>
        </a>
        <a href="settings.html" class="nav-link flex items-center px-4 py-3">
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-settings-line"></i>
          </div>
          <span>Settings</span>
        </a>
        <a href="#" class="nav-link flex items-center px-4 py-3" id="logoutLink">
          <div class="w-6 h-6 flex items-center justify-center mr-3">
            <i class="ri-logout-box-line"></i>
          </div>
          <span>Logout</span>
        </a>
      </nav>
    </aside>
    <!-- Main Content Wrapper -->
    <div class="flex-1 md:ml-64 flex flex-col min-h-screen">
      <!-- Header -->
      <header
        class="header h-14 sm:h-16 flex items-center justify-between px-3 sm:px-4 md:px-6 sticky top-0 z-10"
      >
        <div class="flex items-center md:hidden">
          <button
            id="menuToggle"
            class="w-10 h-10 flex items-center justify-center text-gray-600 dark:text-gray-300"
          >
            <i class="ri-menu-line text-xl"></i>
          </button>
        </div>
        <div class="flex-1 md:flex-none relative md:w-[32rem] mx-4">
          <!-- Search Button -->
          <button type="button" id="simple-search-btn" class="py-2 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-gray-200 font-semibold bg-white text-gray-800 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-200 dark:hover:bg-neutral-700">
            <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.3-4.3"></path>
            </svg>
            <span class="hidden sm:inline">Search</span>
            <span class="hidden sm:inline text-xs text-gray-400 dark:text-gray-500 font-normal ml-1">(Ctrl+K)</span>
          </button>

          <!-- Simple Search Modal -->
          <div id="simple-search-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-xl">
              <div class="p-4 border-b border-gray-200 dark:border-gray-700 relative">
                <div class="relative">
                  <div class="absolute inset-y-0 start-0 flex items-center ps-3.5">
                    <svg class="size-4 text-gray-400 dark:text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="11" cy="11" r="8"></circle>
                      <path d="m21 21-4.3-4.3"></path>
                    </svg>
                  </div>
                  <input id="simple-search-input" class="py-2.5 ps-10 pe-4 block w-full border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200" type="text" placeholder="Search events, students, or organizations..." autofocus>
                </div>
                <button type="button" id="simple-search-close-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="size-5">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
              
              <div class="max-h-80 overflow-y-auto p-2" id="simple-search-results">
                <!-- Results will appear here -->
                <div class="text-center py-8 px-4 text-gray-500 dark:text-gray-400">
                  <div class="text-5xl text-gray-300 dark:text-gray-600 mb-3">
                    <i class="ri-search-line"></i>
                  </div>
                  <p class="mb-1">Type to search across all content</p>
                  <p class="text-xs text-gray-400 dark:text-gray-500 font-normal ml-1">(Ctrl+K)</p>
                </div>
              </div>
              
              <div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex flex-wrap items-center gap-2 text-xs text-gray-500 dark:text-gray-400">
                <span class="font-semibold">Tip:</span>
                <div class="flex-1">
                  Search for events, students, or organizations. Click a result to navigate directly to it.
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <div class="relative" id="notificationContainer">
            <button
              id="notificationButton"
              class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 relative transition-colors duration-150"
            >
              <i class="ri-notification-3-line text-slate-600 dark:text-slate-300"></i>
              <span
                id="notificationBadge"
                class="absolute top-1 right-1 w-4 h-4 bg-red-500 rounded-full text-white text-xs flex items-center justify-center hidden"
                >0</span 
              >
            </button>
            <div
              id="notificationPanel"
              class="hidden absolute right-0 mt-2 w-80 sm:w-96 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden"
            >
              <div class="p-4 border-b border-slate-200 dark:border-slate-700">
                <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-100">Notifications</h3>
              </div>
              <div class="max-h-96 overflow-y-auto" id="notificationListContainer">
                <div id="notificationList">
                  <!-- Notifications will be dynamically populated -->
                  <div class="text-center py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"></div>
                    <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Loading notifications...</p>
                  </div>
                </div>
              </div>
              <div class="p-3 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
                <button id="markAllReadBtn" class="w-full mb-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-slate-300 rounded-button text-sm font-medium transition-colors duration-150">Mark all as read</button>
                <a href="notifications.html" class="nav-link block text-center text-sm text-primary dark:text-sky-400 hover:underline">View all notifications</a>
              </div>
            </div>
          </div>
          <label class="switch">
            <input type="checkbox" id="darkModeToggle" />
            <span class="slider"></span>
          </label>
          <div class="flex items-center">
            <div
              class="w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-300 flex items-center justify-center overflow-hidden border border-gray-300 dark:border-gray-600"
            >
              <img
                id="headerAdminProfilePic"
                src="assets/images/default-avatar.png"
                alt="Profile"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="ml-3 hidden md:block">
              <p id="headerAdminName" class="text-sm font-medium">Loading...</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                Administrator
              </p>
            </div>
          </div>
        </div>
      </header>
      <!-- Mobile Sidebar -->
      <div
        id="mobileSidebar"
        class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"
        style="display: none"
      >
        <div class="bg-white dark:bg-gray-800 w-64 h-full overflow-y-auto">
          <div class="p-4 flex items-center justify-between">
            <a
          href="index.html"
          class="flex items-center text-gray-800 dark:text-gray-200"
        >
            <span class="text-2xl font-['Pacifico'] text-primary">iTeam University</span>
            </a>
            <button
              id="closeMobileMenu"
              class="w-8 h-8 flex items-center justify-center"
            >
              <i class="ri-close-line text-xl"></i>
            </button>
          </div>
          <nav class="mt-6 mobile-nav">
            <!-- Mobile navigation links will mirror the main sidebar -->
             <div class="px-4 mb-2 text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400">Main</div>
             <a href="dashboard.html" class="nav-link flex items-center px-4 py-3 active"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-dashboard-line"></i></div><span>Dashboard</span></a>
             <a href="events.html" class="nav-link flex items-center px-4 py-3"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-calendar-event-line"></i></div><span>Events</span></a>
             <a href="calendar.html" class="nav-link flex items-center px-4 py-3"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-calendar-line"></i></div><span>Calendar</span></a>
             <a href="organizations.html" class="nav-link flex items-center px-4 py-3"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-building-line"></i></div><span>Organizations</span></a>
             <a href="students.html" class="nav-link flex items-center px-4 py-3"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-user-line"></i></div><span>Students</span></a>
             <a href="gallery.html" class="nav-link flex items-center px-4 py-3"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-gallery-line"></i></div><span>Gallery</span></a>
             <a href="manage-images.html" class="nav-link flex items-center px-4 py-3"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-image-line"></i></div><span>Manage Images</span></a>
             <div class="px-4 mt-6 mb-2 text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400">Account</div>
             <a href="profile.html" class="nav-link flex items-center px-4 py-3"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-user-settings-line"></i></div><span>Profile</span></a>
             <a href="settings.html" class="nav-link flex items-center px-4 py-3"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-settings-line"></i></div><span>Settings</span></a>
             <a href="#" class="nav-link flex items-center px-4 py-3" id="mobileLogoutLink"><div class="w-6 h-6 flex items-center justify-center mr-3"><i class="ri-logout-box-line"></i></div><span>Logout</span></a>
          </nav>
        </div>
      </div>
      <!-- Main Content Area (to be populated by JS) -->
      <main id="content" class="flex-1 p-3 sm:p-4 md:p-6">
        <!-- Dynamic content will be loaded here -->
      </main>
      <!-- Footer -->
      <footer class="px-3 sm:px-4 md:px-6 py-3 sm:py-4 border-t border-gray-200 dark:border-gray-700">
        <div class="flex flex-col sm:flex-row justify-between items-center">
          <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mb-2 sm:mb-0">
            &copy; 2025 University Event Management. All rights reserved.
          </div>
          <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
            Version 1.2.5
          </div>
        </div>
      </footer>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logoutConfirmModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[100] hidden p-4">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md">
        <div class="p-6 text-center">
          <i class="ri-question-line text-5xl text-yellow-500 mx-auto mb-4"></i>
          <h3 class="mb-5 text-lg font-normal text-gray-600 dark:text-gray-300">Are you sure you want to logout?</h3>
          <p class="mb-6 text-sm text-gray-500 dark:text-gray-400">You will be returned to the login page.</p>
          <button id="confirmLogoutBtn" type="button" class="text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center me-2">
            Yes, Logout
          </button>
          <button id="cancelLogoutBtn" type="button" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Include Preline CSS and JS in correct order -->
    <link href="https://cdn.jsdelivr.net/npm/preline@2.0.3/dist/preline.min.css" rel="stylesheet" />
    <!-- Move all scripts to the end of the body -->
    <script src="dash.js"></script> <!-- For existing general UI logic like mobile menu, notifications -->
    <script src="router.js"></script>
    <script src="main.js"></script> <!-- For view loading and dark mode -->
  
    <!-- Put Preline JS last so it's loaded after your custom scripts -->
    <script src="https://cdn.jsdelivr.net/npm/preline@2.0.3/dist/preline.min.js"></script>

    <script>
      // Move this initialization code after Preline JS has loaded
      document.addEventListener('DOMContentLoaded', () => {
        // Initialize components after Preline is fully loaded
        setTimeout(() => {
          // Check if HSOverlay exists
          if (typeof HSOverlay !== 'undefined') {
            HSOverlay.autoInit();
          }
          
          // Check if HSComboBox exists
          if (typeof HSComboBox !== 'undefined') {
            HSComboBox.autoInit();
          }
          
          // Add event listener for search modal if the button exists
          const searchButton = document.querySelector('[data-hs-overlay="#json-example-with-tab-filter-using-modal-popup-with-shortcut-call-trigger"]');
          if (searchButton) {
            searchButton.addEventListener('click', function() {
              setTimeout(() => {
                const comboBoxElement = document.querySelector('#json-example-with-tab-filter-using-modal-popup-with-shortcut-call-trigger [data-hs-combo-box]');
                if (comboBoxElement && typeof HSComboBox !== 'undefined') {
                  const comboBox = HSComboBox.getInstance(comboBoxElement);
                  if (comboBox) {
                    comboBox.recalculate();
                  }
                  
                  // Focus the search input
                  const searchInput = document.getElementById('json-example-with-tab-filter-using-modal-popup-with-shortcut-call-trigger-input');
                  if (searchInput) {
                    searchInput.focus();
                  }
                }
              }, 150);
            });
          }
        }, 100); // Small delay to ensure Preline is fully initialized
      });

      // Setup simple search
      document.addEventListener('DOMContentLoaded', () => {
        const searchBtn = document.getElementById('simple-search-btn');
        const searchModal = document.getElementById('simple-search-modal');
        const searchInput = document.getElementById('simple-search-input');
        const searchResults = document.getElementById('simple-search-results');
        const closeBtn = document.getElementById('simple-search-close-btn');
        
        // Define the debounce function that was missing
        function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        }
        
        if (searchBtn && searchModal && searchInput && searchResults && closeBtn) {
          // Open search modal
          searchBtn.addEventListener('click', () => {
            searchModal.classList.remove('hidden');
            searchModal.classList.add('flex'); // Make sure it's displayed as flex
            setTimeout(() => searchInput.focus(), 50);
          });
          
          // Close search modal
          closeBtn.addEventListener('click', () => {
            searchModal.classList.add('hidden');
            searchModal.classList.remove('flex');
          });
          
          // Close on outside click
          searchModal.addEventListener('click', (e) => {
            if (e.target === searchModal) {
              searchModal.classList.add('hidden');
              searchModal.classList.remove('flex');
            }
          });
          
          // Handle search input with debounce
          const debouncedSearchHandler = debounce(() => {
            const query = searchInput.value.trim();
            
            if (query.length < 2) {
              searchResults.innerHTML = `
                <div class="text-center py-8 px-4 text-gray-500 dark:text-gray-400">
                  <div class="text-5xl text-gray-300 dark:text-gray-600 mb-3">
                    <i class="ri-search-line"></i>
                  </div>
                  <p class="mb-1">Type at least 2 characters to search</p>
                  <p class="text-xs text-gray-400 dark:text-gray-500">You can also use the keyboard shortcut <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">Ctrl</kbd>+<kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded">K</kbd></p>
                </div>
              `;
              return;
            }
            
            // Show loading indicator
            searchResults.innerHTML = '<div class="flex justify-center p-4"><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div></div>';
            
            console.log('Fetching search results for:', query);
            
            // Call the search API - Fix URL encoding for spaces
            fetch(`/iteam-university-website/admin/api/search.php?q=${encodeURIComponent(query)}&limit=8`)
              .then(response => {
                if (!response.ok) {
                  throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
              })
              .then(data => {
                console.log('Search API response:', data);
                
                if (data.success && data.results && data.results.length > 0) {
                  // Group results by type
                  const groupedResults = data.results.reduce((acc, item) => {
                    if (!acc[item.type]) {
                      acc[item.type] = [];
                    }
                    acc[item.type].push(item);
                    return acc;
                  }, {});
                  
                  // Create HTML for results
                  let resultsHTML = '';
                  
                  // Add section for each type
                  const typeOrder = ['event', 'organization', 'student']; // Define display order
                  
                  typeOrder.forEach(type => {
                    if (groupedResults[type] && groupedResults[type].length > 0) {
                      // Add section header
                      resultsHTML += `
                        <div class="py-2 px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                          ${type === 'event' ? 'Events' : type === 'organization' ? 'Organizations' : 'Students'}
                        </div>
                      `;
                      
                      // Add items
                      groupedResults[type].forEach(item => {
                        resultsHTML += `
                          <div class="cursor-pointer px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" data-path="${item.path}">
                            <div class="flex justify-between items-center">
                              <div class="flex items-center">
                                <div class="w-6 h-6 flex items-center justify-center mr-2 text-gray-500 dark:text-gray-400">
                                  <i class="${item.icon}"></i>
                                </div>
                                <div class="text-gray-800 dark:text-gray-200">${item.title}</div>
                              </div>
                              <div class="flex items-center">
                                ${item.status === 'draft' ? 
                                  '<span class="text-xs py-1 px-2 rounded-full bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 mr-2">Draft</span>' : ''}
                                ${item.status === 'inactive' ? 
                                  '<span class="text-xs py-1 px-2 rounded-full bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400 mr-2">Inactive</span>' : ''}
                                ${item.status === 'past' ? 
                                  '<span class="text-xs py-1 px-2 rounded-full bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 mr-2">Past</span>' : ''}
                                ${item.formattedDate ? 
                                  '<span class="text-xs text-gray-500 dark:text-gray-400">' + item.formattedDate + '</span>' : ''}
                              </div>
                            </div>
                          </div>
                        `;
                      });
                    }
                  });
                  
                  if (resultsHTML) {
                    searchResults.innerHTML = resultsHTML;
                    
                    // Add click handlers to results
                    searchResults.querySelectorAll('[data-path]').forEach(el => {
                      el.addEventListener('click', () => {
                        const path = el.dataset.path;
                        searchModal.classList.add('hidden');
                        searchModal.classList.remove('flex');
                        
                        console.log("Navigating to search result:", path);
                        
                        // Use the router instead of direct location change
                        window.router.navigateTo(path);
                      });
                    });
                  } else {
                    showNoResults(query);
                  }
                } else {
                  showNoResults(query);
                }
              })
              .catch(error => {
                console.error('Search error:', error);
                searchResults.innerHTML = `
                  <div class="text-center p-6">
                    <div class="text-5xl text-red-400 mb-3">
                      <i class="ri-error-warning-line"></i>
                    </div>
                    <div class="text-gray-500 dark:text-gray-400">An error occurred while searching</div>
                    <div class="text-sm text-gray-400 dark:text-gray-500 mt-2">${error.message}</div>
                  </div>
                `;
              });
      }, 300);
      
      // Add the event listener with the debounced function
      searchInput.addEventListener('input', debouncedSearchHandler);
      
      // Show no results message
      function showNoResults(query) {
        searchResults.innerHTML = `
          <div class="text-center p-6">
            <div class="text-5xl text-gray-300 dark:text-gray-600 mb-3">
              <i class="ri-search-line"></i>
            </div>
            <div class="text-gray-500 dark:text-gray-400">No results found for "${query}"</div>
          </div>
        `;
      }
      
      // Add keyboard shortcut (Ctrl+K or Cmd+K)
      document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          searchBtn.click();
        }
        
        // Close on escape
        if (e.key === 'Escape' && !searchModal.classList.contains('hidden')) {
          searchModal.classList.add('hidden');
          searchModal.classList.remove('flex');
        }
      });
    }
  });
</script>
<script src="event-details.js"></script>
  </body>
</html>
